---
---
<!-- Lightbox Overlay -->
<div class="lightbox-overlay" id="lightbox">
  <button class="lightbox-close" aria-label="Close">&times;</button>
  <button class="lightbox-prev" aria-label="Previous">&#10094;</button>
  <button class="lightbox-next" aria-label="Next">&#10095;</button>
  
  <div class="lightbox-content">
    <img class="lightbox-image" src="" alt="" style="display: none;" />
    <video class="lightbox-video" controls style="display: none;">
      <source src="" type="video/mp4" />
    </video>
  </div>
</div>

<script is:inline>
const BASE_URL = import.meta.env.BASE_URL || '/';

function normalizeImagePath(src) {
  if (!src || src.startsWith('http')) return src;
  
  if (!src.startsWith('/')) {
    return BASE_URL.endsWith('/') 
      ? BASE_URL + src 
      : BASE_URL + '/' + src;
  }
  
  if (BASE_URL === '/') return src;
  return BASE_URL.replace(/\/$/, '') + src;
}

function openLightbox(src, type) {
  const overlay = document.getElementById('lightbox');
  const img = overlay.querySelector('.lightbox-image');
  const video = overlay.querySelector('.lightbox-video');
  const normalizedSrc = normalizeImagePath(src);
  
  if (type === 'image') {
    img.src = normalizedSrc;
    img.style.display = 'block';
    video.style.display = 'none';
    video.querySelector('source').src = '';
    video.load(); 
  } else if (type === 'video') {
    video.querySelector('source').src = normalizedSrc;
    video.load();
    video.style.display = 'block';
    img.style.display = 'none';
    img.src = '';
  }
  
  overlay.classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeLightbox() {
  const overlay = document.getElementById('lightbox');
  const video = overlay.querySelector('.lightbox-video');
  video.pause();
  video.querySelector('source').src = '';
  overlay.classList.remove('active');
  document.body.style.overflow = '';
}

document.addEventListener('DOMContentLoaded', () => {
    const closeBtn = document.querySelector('.lightbox-close');
    if (closeBtn) {
        closeBtn.addEventListener('click', closeLightbox);
    }
    
    const lightbox = document.getElementById('lightbox');
    if (lightbox) {
        lightbox.addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeLightbox();
        });
    }

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeLightbox();
    });
});

window.openLightbox = openLightbox;
</script>

<style is:global>
.lightbox-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.95);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.lightbox-overlay.active {
  display: flex;
}

.lightbox-close {
  position: absolute;
  top: 20px;
  right: 30px;
  font-size: 40px;
  color: white;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 10001; /* Ensure above content */
}

.lightbox-prev,
.lightbox-next {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 30px;
  color: white;
  background: rgba(0, 0, 0, 0.5);
  border: none;
  cursor: pointer;
  padding: 10px;
  z-index: 10001;
}

.lightbox-prev {
  left: 20px;
  display: none; /* Hidden by default as per requirements */
}

.lightbox-next {
  right: 20px;
  display: none; /* Hidden by default as per requirements */
}

.lightbox-content {
    position: relative;
    max-width: 90%;
    max-height: 90%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.lightbox-image, .lightbox-video {
  max-width: 100%;
  max-height: 90vh;
  object-fit: contain;
}
</style>
